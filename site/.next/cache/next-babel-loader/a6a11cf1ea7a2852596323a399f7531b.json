{"ast":null,"code":"import _objectWithoutProperties from \"@babel/runtime-corejs2/helpers/esm/objectWithoutProperties\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nvar _jsxFileName = \"C:\\\\Users\\\\wojtalam\\\\Workspace\\\\Github\\\\arc-keystone5\\\\site\\\\components\\\\Rsvp.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\n/** @jsx jsx */\nimport { Mutation, Query } from 'react-apollo';\nimport { jsx } from '@emotion/core';\nimport { Button as ButtonPrimitive, CheckmarkIcon, Loading } from '../primitives';\nimport { useAuth } from '../lib/authetication';\nimport { GET_RSVPS, UPDATE_RSVP, ADD_RSVP } from '../graphql/rsvps';\nimport AuthModal from './auth/modal';\n\nfunction validateRsvp(_ref) {\n  var userRsvps = _ref.userRsvps,\n      eventRsvps = _ref.eventRsvps,\n      event = _ref.event;\n\n  if (!event || !event.isRsvpAvailable) {\n    return {\n      okay: false,\n      message: null\n    }; // RSVP is not available\n  }\n\n  if (new Date() > new Date(event.startTime)) {\n    return {\n      okay: false,\n      message: null\n    }; // This event is in the past.\n  }\n\n  if (event.maxRsvps !== null && eventRsvps.length >= event.maxRsvps && !userRsvps.length) {\n    return {\n      okay: false,\n      message: 'Max attendees reached.'\n    };\n  }\n\n  return {\n    okay: true\n  };\n}\n\nvar Rsvp = function Rsvp(_ref2) {\n  var children = _ref2.children,\n      event = _ref2.event,\n      text = _ref2.text,\n      themeColor = _ref2.themeColor;\n\n  var _useAuth = useAuth(),\n      isAuthenticated = _useAuth.isAuthenticated,\n      isLoading = _useAuth.isLoading,\n      user = _useAuth.user;\n\n  var eventId = event.id;\n  var isPast = new Date() > new Date(event.startTime);\n\n  if (isLoading) {\n    return null;\n  }\n\n  if (!isAuthenticated) {\n    return isPast ? null : children({\n      component: jsx(AuthModal, {\n        mode: \"signin\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40\n        },\n        __self: this\n      }, function (_ref3) {\n        var openModal = _ref3.openModal;\n        return jsx(ButtonWrapper, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 42\n          },\n          __self: this\n        }, jsx(\"span\", {\n          css: {\n            marginRight: '0.5em',\n            flex: 1\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 43\n          },\n          __self: this\n        }, text), jsx(Button, {\n          href: \"/signin\",\n          onClick: openModal,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44\n          },\n          __self: this\n        }, \"Sign In\"));\n      })\n    });\n  }\n\n  return jsx(Query, {\n    query: GET_RSVPS,\n    variables: {\n      event: eventId,\n      user: user.id\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55\n    },\n    __self: this\n  }, function (_ref4) {\n    var data = _ref4.data,\n        loadingData = _ref4.loading,\n        error = _ref4.error;\n\n    if (error) {\n      console.error(error);\n      return null;\n    }\n\n    if (loadingData) {\n      return children({\n        component: jsx(ButtonWrapper, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 65\n          },\n          __self: this\n        }, jsx(\"span\", {\n          css: {\n            marginRight: '0.5em',\n            flex: 1\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 66\n          },\n          __self: this\n        }, text), jsx(Loading, {\n          size: \"xsmall\",\n          color: themeColor,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 67\n          },\n          __self: this\n        }))\n      });\n    }\n\n    var userRsvps = data.userRsvps,\n        eventRsvps = data.eventRsvps,\n        event = data.event;\n    var userResponse = userRsvps && userRsvps[0];\n    var hasResponded = Boolean(userResponse);\n\n    var _validateRsvp = validateRsvp({\n      userRsvps: userRsvps,\n      eventRsvps: eventRsvps,\n      event: event\n    }),\n        okay = _validateRsvp.okay,\n        message = _validateRsvp.message;\n\n    if (!okay) {\n      return children({\n        message: message\n      });\n    }\n\n    var refetch = function refetch() {\n      return [{\n        query: GET_RSVPS,\n        variables: {\n          event: eventId,\n          user: user.id\n        }\n      }];\n    };\n\n    return jsx(Mutation, {\n      mutation: hasResponded ? UPDATE_RSVP : ADD_RSVP,\n      refetchQueries: refetch,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, function (updateRsvp, _ref5) {\n      var mutationError = _ref5.error,\n          mutationLoading = _ref5.loading;\n\n      if (mutationError) {\n        return children({\n          message: mutationError.message\n        });\n      }\n\n      var doRespond = function doRespond(status) {\n        return updateRsvp({\n          variables: {\n            rsvp: hasResponded ? userResponse.id : null,\n            event: eventId,\n            user: user.id,\n            status: status\n          }\n        });\n      };\n\n      var respondYes = function respondYes() {\n        return doRespond('yes');\n      };\n\n      var respondNo = function respondNo() {\n        return doRespond('no');\n      };\n\n      var isGoing = hasResponded ? userResponse.status === 'yes' : false;\n      return children({\n        component: jsx(ButtonWrapper, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 112\n          },\n          __self: this\n        }, jsx(\"span\", {\n          css: {\n            marginRight: '0.5em',\n            flex: 1\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 113\n          },\n          __self: this\n        }, text), jsx(Button, {\n          disabled: mutationLoading || isGoing,\n          isSelected: hasResponded && isGoing,\n          background: themeColor,\n          onClick: respondYes,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 114\n          },\n          __self: this\n        }, \"Yes\"), jsx(Button, {\n          disabled: mutationLoading || !isGoing,\n          isSelected: hasResponded && !isGoing,\n          background: themeColor,\n          onClick: respondNo,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 122\n          },\n          __self: this\n        }, \"No\"))\n      });\n    });\n  });\n};\n\nRsvp.defaultProps = {\n  children: function children() {\n    return null;\n  },\n  text: 'Are you going?'\n};\n\nvar ButtonWrapper = function ButtonWrapper(props) {\n  return jsx(\"div\", _extends({\n    css: {\n      alignItems: 'center',\n      display: 'flex',\n      flex: 1,\n      minHeight: 40 // NOTE: stop jumping around when no buttons\n\n    }\n  }, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }));\n};\n\nvar Button = function Button(_ref6) {\n  var background = _ref6.background,\n      children = _ref6.children,\n      isSelected = _ref6.isSelected,\n      props = _objectWithoutProperties(_ref6, [\"background\", \"children\", \"isSelected\"]);\n\n  return jsx(ButtonPrimitive, _extends({\n    css: {\n      boxSizing: 'border-box',\n      marginLeft: '0.25em',\n      minWidth: 92\n    },\n    background: isSelected ? background : null,\n    outline: !isSelected,\n    size: \"small\"\n  }, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }), isSelected ? jsx(CheckmarkIcon, {\n    size: 16,\n    stroke: 3,\n    css: {\n      marginRight: '0.25rem'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }) : null, children);\n};\n\nexport default Rsvp;","map":{"version":3,"sources":["C:/Users/wojtalam/Workspace/Github/arc-keystone5/site/components/Rsvp.js"],"names":["Mutation","Query","jsx","Button","ButtonPrimitive","CheckmarkIcon","Loading","useAuth","GET_RSVPS","UPDATE_RSVP","ADD_RSVP","AuthModal","validateRsvp","userRsvps","eventRsvps","event","isRsvpAvailable","okay","message","Date","startTime","maxRsvps","length","Rsvp","children","text","themeColor","isAuthenticated","isLoading","user","eventId","id","isPast","component","openModal","marginRight","flex","data","loadingData","loading","error","console","userResponse","hasResponded","Boolean","refetch","query","variables","updateRsvp","mutationError","mutationLoading","doRespond","status","rsvp","respondYes","respondNo","isGoing","defaultProps","ButtonWrapper","props","alignItems","display","minHeight","background","isSelected","boxSizing","marginLeft","minWidth"],"mappings":"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","sourcesContent":["/** @jsx jsx */\nimport { Mutation, Query } from 'react-apollo';\nimport { jsx } from '@emotion/core';\n\nimport { Button as ButtonPrimitive, CheckmarkIcon, Loading } from '../primitives';\nimport { useAuth } from '../lib/authetication';\nimport { GET_RSVPS, UPDATE_RSVP, ADD_RSVP } from '../graphql/rsvps';\nimport AuthModal from './auth/modal';\n\nfunction validateRsvp({ userRsvps, eventRsvps, event }) {\n  if (!event || !event.isRsvpAvailable) {\n    return { okay: false, message: null }; // RSVP is not available\n  }\n\n  if (new Date() > new Date(event.startTime)) {\n    return { okay: false, message: null }; // This event is in the past.\n  }\n\n  if (event.maxRsvps !== null && eventRsvps.length >= event.maxRsvps && !userRsvps.length) {\n    return { okay: false, message: 'Max attendees reached.' };\n  }\n\n  return { okay: true };\n}\n\nconst Rsvp = ({ children, event, text, themeColor }) => {\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const eventId = event.id;\n  const isPast = new Date() > new Date(event.startTime);\n\n  if (isLoading) {\n    return null;\n  }\n\n  if (!isAuthenticated) {\n    return isPast\n      ? null\n      : children({\n          component: (\n            <AuthModal mode=\"signin\">\n              {({ openModal }) => (\n                <ButtonWrapper>\n                  <span css={{ marginRight: '0.5em', flex: 1 }}>{text}</span>\n                  <Button href=\"/signin\" onClick={openModal}>\n                    Sign In\n                  </Button>\n                </ButtonWrapper>\n              )}\n            </AuthModal>\n          ),\n        });\n  }\n\n  return (\n    <Query query={GET_RSVPS} variables={{ event: eventId, user: user.id }}>\n      {({ data, loading: loadingData, error }) => {\n        if (error) {\n          console.error(error);\n          return null;\n        }\n\n        if (loadingData) {\n          return children({\n            component: (\n              <ButtonWrapper>\n                <span css={{ marginRight: '0.5em', flex: 1 }}>{text}</span>\n                <Loading size=\"xsmall\" color={themeColor} />\n              </ButtonWrapper>\n            ),\n          });\n        }\n\n        const { userRsvps, eventRsvps, event } = data;\n        const userResponse = userRsvps && userRsvps[0];\n        const hasResponded = Boolean(userResponse);\n        const { okay, message } = validateRsvp({ userRsvps, eventRsvps, event });\n\n        if (!okay) {\n          return children({ message });\n        }\n\n        const refetch = () => [\n          {\n            query: GET_RSVPS,\n            variables: { event: eventId, user: user.id },\n          },\n        ];\n\n        return (\n          <Mutation mutation={hasResponded ? UPDATE_RSVP : ADD_RSVP} refetchQueries={refetch}>\n            {(updateRsvp, { error: mutationError, loading: mutationLoading }) => {\n              if (mutationError) {\n                return children({ message: mutationError.message });\n              }\n\n              const doRespond = status =>\n                updateRsvp({\n                  variables: {\n                    rsvp: hasResponded ? userResponse.id : null,\n                    event: eventId,\n                    user: user.id,\n                    status,\n                  },\n                });\n              const respondYes = () => doRespond('yes');\n              const respondNo = () => doRespond('no');\n\n              const isGoing = hasResponded ? userResponse.status === 'yes' : false;\n\n              return children({\n                component: (\n                  <ButtonWrapper>\n                    <span css={{ marginRight: '0.5em', flex: 1 }}>{text}</span>\n                    <Button\n                      disabled={mutationLoading || isGoing}\n                      isSelected={hasResponded && isGoing}\n                      background={themeColor}\n                      onClick={respondYes}\n                    >\n                      Yes\n                    </Button>\n                    <Button\n                      disabled={mutationLoading || !isGoing}\n                      isSelected={hasResponded && !isGoing}\n                      background={themeColor}\n                      onClick={respondNo}\n                    >\n                      No\n                    </Button>\n                  </ButtonWrapper>\n                ),\n              });\n            }}\n          </Mutation>\n        );\n      }}\n    </Query>\n  );\n};\n\nRsvp.defaultProps = {\n  children: () => null,\n  text: 'Are you going?',\n};\n\nconst ButtonWrapper = props => (\n  <div\n    css={{\n      alignItems: 'center',\n      display: 'flex',\n      flex: 1,\n      minHeight: 40, // NOTE: stop jumping around when no buttons\n    }}\n    {...props}\n  />\n);\n\nconst Button = ({ background, children, isSelected, ...props }) => (\n  <ButtonPrimitive\n    css={{\n      boxSizing: 'border-box',\n      marginLeft: '0.25em',\n      minWidth: 92,\n    }}\n    background={isSelected ? background : null}\n    outline={!isSelected}\n    size=\"small\"\n    {...props}\n  >\n    {isSelected ? <CheckmarkIcon size={16} stroke={3} css={{ marginRight: '0.25rem' }} /> : null}\n    {children}\n  </ButtonPrimitive>\n);\n\nexport default Rsvp;\n"]},"metadata":{},"sourceType":"module"}